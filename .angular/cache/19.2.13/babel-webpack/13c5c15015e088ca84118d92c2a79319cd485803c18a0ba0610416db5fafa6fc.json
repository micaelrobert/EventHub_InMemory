{"ast":null,"code":"import { CommonModule } from \"@angular/common\";\nimport { Validators, ReactiveFormsModule } from \"@angular/forms\";\nimport { MatDialogModule, MAT_DIALOG_DATA } from \"@angular/material/dialog\";\nimport { MatFormFieldModule } from \"@angular/material/form-field\";\nimport { MatInputModule } from \"@angular/material/input\";\nimport { MatButtonModule } from \"@angular/material/button\";\nimport { MatIconModule } from \"@angular/material/icon\";\nimport { MatSelectModule } from \"@angular/material/select\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../services/ingressos.service\";\nimport * as i3 from \"../../services/notification.service\";\nimport * as i4 from \"@angular/material/dialog\";\nimport * as i5 from \"@angular/material/form-field\";\nimport * as i6 from \"@angular/material/input\";\nimport * as i7 from \"@angular/material/button\";\nimport * as i8 from \"@angular/material/icon\";\nexport let ComprarIngressoDialogComponent = /*#__PURE__*/(() => {\n  class ComprarIngressoDialogComponent {\n    data;\n    fb;\n    ingressosService;\n    notificationService;\n    dialogRef;\n    evento;\n    compraForm;\n    quantidades = [];\n    valorTotal = 0;\n    comprando = false;\n    constructor(data, fb, ingressosService, notificationService, dialogRef) {\n      this.data = data;\n      this.fb = fb;\n      this.ingressosService = ingressosService;\n      this.notificationService = notificationService;\n      this.dialogRef = dialogRef;\n      this.evento = data.evento;\n      this.gerarQuantidades();\n      this.criarForm();\n    }\n    gerarQuantidades() {\n      const maxQuantidade = Math.min(this.evento.ingressosDisponiveis, 10);\n      this.quantidades = Array.from({\n        length: maxQuantidade\n      }, (_, i) => i + 1);\n    }\n    criarForm() {\n      this.compraForm = this.fb.group({\n        nomeComprador: [\"\", [Validators.required, Validators.minLength(3)]],\n        emailComprador: [\"\", [Validators.required, Validators.email]],\n        telefoneComprador: [\"\", [Validators.required, Validators.pattern(/^\\(\\d{2}\\) \\d{4,5}-\\d{4}$/)]],\n        quantidade: [1, [Validators.required, Validators.min(1)]]\n      });\n      this.calcularTotal();\n    }\n    calcularTotal() {\n      const quantidade = this.compraForm.get(\"quantidade\")?.value || 0;\n      this.valorTotal = quantidade * this.evento.precoIngresso;\n    }\n    confirmarCompra() {\n      if (this.compraForm.invalid) {\n        this.notificationService.error('Por favor, preencha todos os campos corretamente');\n        return;\n      }\n      this.comprando = true;\n      const compra = {\n        eventoId: this.evento.id,\n        nomeComprador: this.compraForm.value.nomeComprador,\n        emailComprador: this.compraForm.value.emailComprador,\n        telefoneComprador: this.compraForm.value.telefoneComprador,\n        quantidade: this.compraForm.value.quantidade\n      };\n      this.ingressosService.comprarIngresso(compra).subscribe({\n        next: response => {\n          this.comprando = false;\n          if (response.sucesso) {\n            this.notificationService.success('Compra realizada com sucesso!');\n            this.dialogRef.close(true);\n          } else {\n            this.notificationService.error(response.mensagem || 'Erro ao processar compra');\n          }\n        },\n        error: err => {\n          this.comprando = false;\n          this.notificationService.error('Erro na comunicação com o servidor');\n          console.error(err);\n        }\n      });\n    }\n    cancelar() {\n      this.dialogRef.close(false);\n    }\n    formatarTelefone(event) {\n      let input = event.target;\n      let value = input.value.replace(/\\D/g, '');\n      if (value.length > 11) value = value.slice(0, 11);\n      if (value.length > 0) {\n        value = value.replace(/^(\\d{2})(\\d)/g, '($1) $2');\n        value = value.replace(/(\\d{5})(\\d)/, '$1-$2');\n      }\n      input.value = value;\n      this.compraForm.get('telefoneComprador')?.setValue(value, {\n        emitEvent: false\n      });\n    }\n    static ɵfac = function ComprarIngressoDialogComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || ComprarIngressoDialogComponent)(i0.ɵɵdirectiveInject(MAT_DIALOG_DATA), i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.IngressosService), i0.ɵɵdirectiveInject(i3.NotificationService), i0.ɵɵdirectiveInject(i4.MatDialogRef));\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ComprarIngressoDialogComponent,\n      selectors: [[\"app-comprar-ingresso-dialog\"]],\n      decls: 29,\n      vars: 0,\n      consts: [[1, \"dialog-container\"], [1, \"dialog-header\"], [\"mat-icon-button\", \"\", \"aria-label\", \"Fechar\", 1, \"close-btn\", 3, \"click\"], [\"mat-dialog-content\", \"\"], [2, \"margin-bottom\", \"20px\"], [\"appearance\", \"outline\", 2, \"width\", \"100%\", \"margin-bottom\", \"15px\"], [\"matInput\", \"\", \"value\", \"Apenas um campo para testar layout\"], [1, \"dialog-actions\"], [\"mat-stroked-button\", \"\", \"color\", \"warn\", \"type\", \"button\", 3, \"click\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", \"type\", \"button\", 3, \"click\"]],\n      template: function ComprarIngressoDialogComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h2\");\n          i0.ɵɵtext(3, \"Teste de Di\\u00E1logo Simples\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(4, \"p\");\n          i0.ɵɵtext(5, \"Verificando o layout b\\u00E1sico.\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(6, \"button\", 2);\n          i0.ɵɵlistener(\"click\", function ComprarIngressoDialogComponent_Template_button_click_6_listener() {\n            return ctx.cancelar();\n          });\n          i0.ɵɵelementStart(7, \"mat-icon\");\n          i0.ɵɵtext(8, \"close\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(9, \"div\", 3)(10, \"p\", 4);\n          i0.ɵɵtext(11, \"Este \\u00E9 um par\\u00E1grafo de teste dentro do conte\\u00FAdo do di\\u00E1logo.\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(12, \"p\", 4);\n          i0.ɵɵtext(13, \"Se voc\\u00EA vir esta linha e a de baixo, o conte\\u00FAdo est\\u00E1 rolando!\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(14, \"p\", 4);\n          i0.ɵɵtext(15, \"Linha extra para for\\u00E7ar a rolagem, se o di\\u00E1logo for pequeno.\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(16, \"p\", 4);\n          i0.ɵɵtext(17, \"Mais uma linha para garantir a rolagem.\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(18, \"p\", 4);\n          i0.ɵɵtext(19, \"\\u00DAltima linha de conte\\u00FAdo para teste de rolagem.\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(20, \"mat-form-field\", 5)(21, \"mat-label\");\n          i0.ɵɵtext(22, \"Campo de Teste\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(23, \"input\", 6);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(24, \"div\", 7)(25, \"button\", 8);\n          i0.ɵɵlistener(\"click\", function ComprarIngressoDialogComponent_Template_button_click_25_listener() {\n            return ctx.cancelar();\n          });\n          i0.ɵɵtext(26, \"Cancelar Teste\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(27, \"button\", 9);\n          i0.ɵɵlistener(\"click\", function ComprarIngressoDialogComponent_Template_button_click_27_listener() {\n            return ctx.cancelar();\n          });\n          i0.ɵɵtext(28, \"OK\");\n          i0.ɵɵelementEnd()()();\n        }\n      },\n      dependencies: [CommonModule, ReactiveFormsModule, MatDialogModule, i4.MatDialogContent, MatFormFieldModule, i5.MatFormField, i5.MatLabel, MatInputModule, i6.MatInput, MatButtonModule, i7.MatButton, i7.MatIconButton, MatIconModule, i8.MatIcon, MatSelectModule],\n      encapsulation: 2\n    });\n  }\n  return ComprarIngressoDialogComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}