{"ast":null,"code":"import { inject } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ReactiveFormsModule, FormBuilder, Validators } from '@angular/forms';\nimport { Router } from '@angular/router';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { AuthService } from '../../../services/auth.service'; // Ajuste o caminho se necessário\nimport { NotificationService } from '../../../services/notification.service'; // Ajuste o caminho se necessário\nimport * as i0 from \"@angular/core\";\n// Validador customizado para verificar se as senhas coincidem\nexport function senhasCoincidemValidator(control) {\n  const senha = control.get('senha');\n  const confirmacaoSenha = control.get('confirmacaoSenha');\n  if (senha && confirmacaoSenha && senha.value !== confirmacaoSenha.value) {\n    confirmacaoSenha.setErrors({\n      senhasNaoCoincidem: true\n    });\n    return {\n      senhasNaoCoincidem: true\n    };\n  }\n  // Se as senhas coincidirem, mas confirmacaoSenha já tiver outro erro, não o limpe aqui.\n  // Limpe o erro específico senhasNaoCoincidem se ele existir e as senhas agora coincidirem.\n  if (confirmacaoSenha?.hasError('senhasNaoCoincidem') && senha?.value === confirmacaoSenha?.value) {\n    confirmacaoSenha.setErrors(null); // Limpa o erro específico\n    // Se houver outros erros, eles permanecerão. Se não houver, o campo fica válido.\n    // Para limpar todos os erros se este for o único:\n    // if (Object.keys(confirmacaoSenha.errors || {}).length === 1 && confirmacaoSenha.hasError('senhasNaoCoincidem')) {\n    //   confirmacaoSenha.setErrors(null);\n    // }\n  }\n  return null;\n}\nexport let RegistroComponent = /*#__PURE__*/(() => {\n  class RegistroComponent {\n    registroForm;\n    isLoading = false;\n    hidePassword = true;\n    hideConfirmPassword = true;\n    fb = inject(FormBuilder);\n    authService = inject(AuthService);\n    router = inject(Router);\n    notificationService = inject(NotificationService);\n    ngOnInit() {\n      this.registroForm = this.fb.group({\n        // nomeCompleto: ['', Validators.required], // Se você adicionar no DTO e modelo\n        email: ['', [Validators.required, Validators.email]],\n        senha: ['', [Validators.required, Validators.minLength(6)]],\n        confirmacaoSenha: ['', [Validators.required]]\n      }, {\n        validators: senhasCoincidemValidator\n      }); // Adiciona o validador no nível do FormGroup\n    }\n    onSubmit() {\n      if (this.registroForm.invalid) {\n        this.notificationService.warning('Por favor, corrija os erros no formulário.');\n        this.registroForm.markAllAsTouched();\n        return;\n      }\n      this.isLoading = true;\n      // Não precisamos enviar confirmacaoSenha para o backend\n      const {\n        confirmacaoSenha,\n        ...dadosRegistro\n      } = this.registroForm.value;\n      const payload = dadosRegistro;\n      this.authService.registrar(payload).subscribe({\n        next: response => {\n          this.isLoading = false;\n          if (response.sucesso) {\n            this.notificationService.success(response.mensagem || 'Usuário registrado com sucesso! Faça o login.');\n            this.router.navigate(['/login']);\n          } else {\n            this.notificationService.error(response.mensagem || 'Falha no registro.');\n          }\n        },\n        error: err => {\n          this.isLoading = false;\n          this.notificationService.error(err.error?.mensagem || 'Erro ao tentar registrar. Tente novamente.');\n          console.error(\"Erro no registro:\", err);\n        }\n      });\n    }\n    static ɵfac = function RegistroComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || RegistroComponent)();\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: RegistroComponent,\n      selectors: [[\"app-registro\"]],\n      decls: 2,\n      vars: 0,\n      template: function RegistroComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"p\");\n          i0.ɵɵtext(1, \"registro works!\");\n          i0.ɵɵelementEnd();\n        }\n      },\n      dependencies: [CommonModule, ReactiveFormsModule, MatCardModule, MatFormFieldModule, MatInputModule, MatButtonModule, MatIconModule, MatProgressSpinnerModule],\n      encapsulation: 2\n    });\n  }\n  return RegistroComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}