{"ast":null,"code":"import { inject } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Router } from '@angular/router';\nimport { BehaviorSubject, tap } from 'rxjs';\nimport { environment } from '../../environments/environment';\nimport * as i0 from \"@angular/core\";\nexport let AuthService = /*#__PURE__*/(() => {\n  class AuthService {\n    http = inject(HttpClient);\n    router = inject(Router);\n    authApiUrl = `${environment.apiUrl.replace('/eventos', '').replace('/api', '')}/api/auth`; // Ajuste para garantir que fique /api/auth\n    usuarioAtualSubject = new BehaviorSubject(this.getUsuarioLogadoFromStorage());\n    usuarioAtual$ = this.usuarioAtualSubject.asObservable();\n    constructor() {}\n    getUsuarioLogadoFromStorage() {\n      const email = localStorage.getItem('userEmail');\n      const papel = localStorage.getItem('userRole');\n      const nomeUsuario = localStorage.getItem('userName'); // <<< CARREGAR NOME DE USUÁRIO\n      if (email && papel && nomeUsuario) {\n        return {\n          email,\n          papel,\n          nomeUsuario\n        };\n      }\n      return null;\n    }\n    get usuarioLogadoValor() {\n      return this.usuarioAtualSubject.value;\n    }\n    login(credenciais) {\n      return this.http.post(`${this.authApiUrl}/login`, credenciais).pipe(tap(response => {\n        if (response.sucesso && response.dados) {\n          localStorage.setItem('authToken', response.dados.token);\n          localStorage.setItem('userEmail', response.dados.email);\n          localStorage.setItem('userRole', response.dados.papel);\n          localStorage.setItem('userName', response.dados.nomeUsuario); // <<< SALVAR NOME DE USUÁRIO\n          this.usuarioAtualSubject.next({\n            email: response.dados.email,\n            papel: response.dados.papel,\n            nomeUsuario: response.dados.nomeUsuario // <<< ATUALIZAR SUBJECT COM NOME DE USUÁRIO\n          });\n        }\n      }));\n    }\n    registrar(infoUsuario) {\n      return this.http.post(`${this.authApiUrl}/registrar`, infoUsuario);\n    }\n    logout() {\n      localStorage.removeItem('authToken');\n      localStorage.removeItem('userEmail');\n      localStorage.removeItem('userRole');\n      localStorage.removeItem('userName'); // <<< REMOVER NOME DE USUÁRIO\n      this.usuarioAtualSubject.next(null);\n      this.router.navigate(['/login']);\n    }\n    getToken() {\n      return localStorage.getItem('authToken');\n    }\n    isLoggedIn() {\n      return !!this.getToken();\n    }\n    getPapelUsuario() {\n      if (this.usuarioAtualSubject.value) {\n        // Prioriza o BehaviorSubject\n        return this.usuarioAtualSubject.value.papel;\n      }\n      return localStorage.getItem('userRole'); // Fallback\n    }\n    // Método para pegar o nome do usuário logado\n    getNomeUsuario() {\n      if (this.usuarioAtualSubject.value) {\n        return this.usuarioAtualSubject.value.nomeUsuario;\n      }\n      return localStorage.getItem('userName');\n    }\n    isAdmin() {\n      return this.getPapelUsuario() === 'Admin';\n    }\n    isComum() {\n      return this.getPapelUsuario() === 'Comum';\n    }\n    static ɵfac = function AuthService_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || AuthService)();\n    };\n    static ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n  return AuthService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}