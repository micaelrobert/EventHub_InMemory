{"ast":null,"code":"import { inject } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Router } from '@angular/router';\nimport { BehaviorSubject, tap } from 'rxjs';\nimport { environment } from '../../environments/environment'; // Para a apiUrl base\nimport * as i0 from \"@angular/core\";\nexport let AuthService = /*#__PURE__*/(() => {\n  class AuthService {\n    http = inject(HttpClient);\n    router = inject(Router);\n    // API base para autenticação (ex: https://localhost:7179/api/auth)\n    authApiUrl = `${environment.apiUrl.replace('/eventos', '')}/auth`; // Remove /eventos e adiciona /auth\n    // BehaviorSubject para manter o estado do usuário logado\n    // Inicializa tentando carregar do localStorage\n    usuarioAtualSubject = new BehaviorSubject(this.getUsuarioLogadoFromStorage());\n    usuarioAtual$ = this.usuarioAtualSubject.asObservable();\n    constructor() {}\n    getUsuarioLogadoFromStorage() {\n      const email = localStorage.getItem('userEmail');\n      const papel = localStorage.getItem('userRole');\n      if (email && papel) {\n        return {\n          email,\n          papel\n        };\n      }\n      return null;\n    }\n    get usuarioLogadoValor() {\n      return this.usuarioAtualSubject.value;\n    }\n    login(credenciais) {\n      return this.http.post(`${this.authApiUrl}/login`, credenciais).pipe(tap(response => {\n        if (response.sucesso && response.dados) {\n          localStorage.setItem('authToken', response.dados.token);\n          localStorage.setItem('userEmail', response.dados.email);\n          localStorage.setItem('userRole', response.dados.papel);\n          this.usuarioAtualSubject.next({\n            email: response.dados.email,\n            papel: response.dados.papel\n          });\n        }\n      }));\n    }\n    registrar(infoUsuario) {\n      return this.http.post(`${this.authApiUrl}/registrar`, infoUsuario);\n    }\n    logout() {\n      localStorage.removeItem('authToken');\n      localStorage.removeItem('userEmail');\n      localStorage.removeItem('userRole');\n      this.usuarioAtualSubject.next(null);\n      this.router.navigate(['/login']); // Ou para a home page\n    }\n    getToken() {\n      return localStorage.getItem('authToken');\n    }\n    isLoggedIn() {\n      // Uma verificação simples. Em produção, você também validaria a expiração do token.\n      return !!this.getToken();\n    }\n    getPapelUsuario() {\n      if (this.usuarioLogadoValor) {\n        return this.usuarioLogadoValor.papel;\n      }\n      const papel = localStorage.getItem('userRole'); // Fallback para localStorage se BehaviorSubject não estiver populado\n      return papel;\n    }\n    isAdmin() {\n      return this.getPapelUsuario() === 'Admin';\n    }\n    isComum() {\n      return this.getPapelUsuario() === 'Comum';\n    }\n    static ɵfac = function AuthService_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || AuthService)();\n    };\n    static ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n  return AuthService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}